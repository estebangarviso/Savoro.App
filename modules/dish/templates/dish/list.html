{% extends "shared/base.html" %}
{% load static humanize shared_filters %}
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'dish/css/list.css' %}">
{% endblock extra_css %}
{% block content %}
    {% csrf_token %}
    <div class="row">
        <div class="col s12">
            <a class="waves-effect waves-light btn right red darken-1 add-btn"
               href="{% url 'dish:create' %}">
                <i class="material-icons left">add</i>Agregar nuevo plato
            </a>
        </div>
    </div>
    <!-- Filtros -->
    <div class="row">
        <div class="col s12">
            <div class="card-panel white-text filter-card">
                <h5>
                    <i class="material-icons">filter_list</i>Filtros de búsqueda
                </h5>
                <form method="get" id="filterForm">
                    <div class="row filter-row">
                        <div class="col s12 m4">
                            <div class="input-field filter-input filter-input-wrapper filter-input-no-margin">
                                <i class="material-icons prefix">search</i>
                                <input type="text"
                                       name="search"
                                       id="search"
                                       value="{{ search_query }}"
                                       placeholder="Buscar por nombre o descripción">
                            </div>
                        </div>
                        <div class="col s12 m4">
                            <div class="input-field filter-input filter-input-wrapper filter-input-no-margin">
                                <i class="material-icons prefix">category</i>
                                <select name="category" id="category" class="browser-default">
                                    <option value="">Todas las categorías</option>
                                    {% for cat in all_categories %}
                                        <option value="{{ cat.id }}"
                                                {% if category_filter == cat.id|stringformat:"s" %}selected{% endif %}>
                                            {{ cat.name }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col s12 m4">
                            <div class="input-field filter-input filter-input-wrapper filter-input-no-margin">
                                <i class="material-icons prefix">label</i>
                                <select name="tag" id="tag" class="browser-default">
                                    <option value="">Todas las etiquetas</option>
                                    {% for tag in all_tags %}
                                        <option value="{{ tag.id }}"
                                                {% if tag_filter == tag.id|stringformat:"s" %}selected{% endif %}>
                                            {{ tag.name }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row filter-row-buttons">
                        <div class="col s12 center-align">
                            <button type="submit"
                                    class="waves-effect waves-light btn filter-btn white deep-purple-text">
                                <i class="material-icons left">search</i>Buscar
                            </button>
                            <a href="{% url 'dish:list' %}"
                               class="waves-effect waves-light btn filter-btn white deep-purple-text">
                                <i class="material-icons left">clear</i>Limpiar
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% if not sections %}
        <div class="row">
            <div class="col s12">
                <div class="card-panel pink lighten-1 white-text no-results">
                    <i class="material-icons">restaurant_menu</i>
                    <h4>No se encontraron platos</h4>
                    <p>
                        {% if search_query or category_filter or tag_filter %}
                            Intenta ajustar los filtros de búsqueda
                        {% else %}
                            No hay platos registrados actualmente
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    {% else %}
        <div id="dishGrid" data-has-next="{{ has_next }}">
            {% include 'dish/partials/dish_sections.html' %}
        </div>
        <!-- Loading indicator -->
        <div class="row hide" id="loadingIndicator">
            <div class="col s12 center-align">
                <div class="preloader-wrapper big active">
                    <div class="spinner-layer spinner-blue-only">
                        <div class="circle-clipper left">
                            <div class="circle"></div>
                        </div>
                        <div class="gap-patch">
                            <div class="circle"></div>
                        </div>
                        <div class="circle-clipper right">
                            <div class="circle"></div>
                        </div>
                    </div>
                </div>
                <p class="grey-text">Cargando más platos...</p>
            </div>
        </div>
    {% endif %}
    <!-- Modal de confirmación de eliminación de plato -->
    <div id="deleteDishModal" class="modal">
        <div class="modal-content">
            <h4 class="red-text">
                <i class="material-icons left">warning</i>Confirmar eliminación
            </h4>
            <p>
                ¿Estás seguro de que deseas eliminar el plato <strong id="dishNameToDelete"></strong>?
            </p>
            <p class="grey-text">Esta acción marcará el plato como eliminado.</p>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-close waves-effect waves-light btn-flat">Cancelar</a>
            <a href="#!"
               class="waves-effect waves-light btn red darken-1"
               id="confirmDeleteDishBtn"
               onclick="return false;">
                <i class="material-icons left">delete</i>Eliminar
            </a>
        </div>
    </div>
{% endblock content %}
{% block extra_js %}
    <script type="module" src="{% static 'dish/js/main.js' %}"></script>
{% endblock extra_js %}
